<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Inflexion</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="todo">
    <meta name="author" content="todo">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="black">
    <!-- Chrome, Firefox OS and Opera -->
    <meta name="msapplication-navbutton-color" content="black">
    <!-- Windows Phone -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!-- iOS Safari -->
    <link rel="manifest" href="todo.manifest">
    <link rel="apple-touch-icon" href="/static/icons/icon.png">
    <link rel="icon" href="/static/icons/favicon.png" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.socket.io/3.1.1/socket.io.min.js"
        integrity="sha384-gDaozqUvc4HTgo8iZjwth73C6dDDeOJsAgpxBcMpZYztUfjHXpzrpdrHRdVp8ySO"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/static/css/main.css">
</head>

<body>
    <!-- <div class="center"> -->
    <div class="container">
        <!-- <form class="row was-validated"> -->
        <form id="inflexion_form" class="row needs-validation" method="post" novalidate>
            <div class="col-auto">
                <div class="form-outline">
                    <label for="pos" class="form-label">Part of Speech</label>
                    <select class="form-select" name="pos" id="pos" required>
                        <!-- <option selected disabled value="">Choose...</option> Interesting option for a default -->
                        <option value="v">Verb</option>
                        <option value="n">Noun</option>
                        <option value="a">Adjective</option>
                    </select>
                </div>
            </div>

            <div class="col-auto">
                <div class="form-outline">
                    <label for="wordform" class="form-label">Wordform</label>
                    <select class="form-select" name="wordform" id="wordform" required>
                        <!-- <option selected disabled>Select Goal Word Form</option> -->
                        <option value="sing">To Singular</option>
                        <option value="plur">To Plural</option>
                        <option value="past">To Past</option>
                        <option value="past_part">To Past Participle</option>
                        <option value="pres_part">To Present Participle</option>
                    </select>
                    <div class="invalid-feedback">
                        Please select a valid wordform for this Part of Speech.
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="form-outline">
                    <label for="word" class="form-label">Word or Collocation</label>
                    <input type="text" class="form-control" name="word" id="word" placeholder=". . ." required>
                    <div class="invalid-feedback">
                        <!-- This sadly doesn't trigger... -->
                        Please provide a word or collocation.
                    </div>
                    <!-- <input type="text" class="form-control" placeholder="Input word or collocation" -->
                    <!-- aria-label="Input word or collocation"> -->
                </div>
            </div>

            <!-- <div class="col-auto">
                <label for="random" class="form-label">&nbsp;</label>
                <button type="submit" name="random" id="random" class="btn btn-outline-warning d-block">Random</button>
            </div> -->

            <div class="col-auto">
                <label for="go" class="form-label">&nbsp;</label>
                <button type="submit" id="go" class="btn btn-outline-success d-block">Go</button>
            </div>
        </form>

        <!-- <hr> -->

        <!-- <div class="input-group">
        <div class="input-group-prepend">
            <span class="input-group-text">Correct Output</span>
        </div>

        <input type="text" class="form-control" placeholder="Output", aria-label="Output">

        <div class="input-group-append">
            <span class="input-group-text">12</span>
        </div>
    </div> -->

        <!-- <hr> -->

        <table class="table">
            <thead class="thead-light">
                <tr>
                    <th class="fit" scope="col">
                        Module
                    </th>
                    <th scope="col">
                        Output
                    </th>
                    <th class="fit" scope="col">
                        Score
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th scope="col">
                        <span class="input-group-text">Inflexion</span>
                    </th>
                    <th scope="col">
                        <input id="inflexion_output" type="text" class="form-control" , aria-label="Output">
                    </th>
                    <th scope="col">
                        <span class="input-group-text">12</span>
                    </th>
                </tr>
                <tr>
                    <th scope="col">
                        <span class="input-group-text">inflect</span>
                    </th>
                    <th scope="col">
                        <input type="text" class="form-control" , aria-label="Output">
                    </th>
                    <th scope="col">
                        <span class="input-group-text">12</span>
                    </th>
                </tr>
                <tr>
                    <th scope="col">
                        <span class="input-group-text">Lingua::EN::Inflexion</span>
                    </th>
                    <th scope="col">
                        <input type="text" class="form-control" , aria-label="Output">
                    </th>
                    <th scope="col">
                        <span class="input-group-text">12</span>
                    </th>
                </tr>
            </tbody>
        </table>
    </div>
    <!-- </div> -->

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.6.0/dist/umd/popper.min.js"
        integrity="sha384-KsvD1yqQ1/1+IA7gi3P0tyJcT3vR+NdBTt13hSJ2lnve8agRGXTTyNaBYmCR/Nwi"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.min.js"
        integrity="sha384-nsg8ua9HAw1y0W1btsyWgBklPnCUAFLuTMS2G72MMONqmOymq585AcH49TLBQObG"
        crossorigin="anonymous"></script>
</body>
<script>
    
    /*// Example starter JavaScript for disabling form submissions if there are invalid fields
    (function () {
        'use strict'

        // Fetch all the forms we want to apply custom Bootstrap validation styles to
        var forms = document.querySelectorAll('.needs-validation')

        // Loop over them and prevent submission
        Array.prototype.slice.call(forms)
            .forEach(function (form) {
                form.addEventListener('submit', function (event) {
                    // Prevent default event
                    event.preventDefault();
                    event.stopPropagation();

                    // Set form validation
                    form.classList.add('was-validated');
                    if (!form.checkValidity()) {
                        return;
                    }

                    // $.ajax({
                    //     type: 'POST',
                    //     url: '/',
                    //     data: {
                    //         pos: $("#pos").val(),
                    //         wordform: $("#wordform").val(),
                    //         word: $("#word").val(),
                    //     },
                    //     success: function () {
                    //         console.log("Submitted data to server.");
                    //     }
                    // })

                    socket.emit("go", {
                        pos: $("#pos").val(),
                        wordform: $("#wordform").val(),
                        word: $("#word").val(),
                    });

                }, false)
            })
    })()*/

    $(document).ready(function () {
        $('#pos').change(function () {
            // $('input[name="stock"]').prop('disabled', this.value != 0 ? false : true);
            console.log("POS has been modified.");
            console.log(this);
            const disabled_wordforms = ["past", "past_part", "pres_part"]
            if (this.value == "v") {
                disabled_wordforms.forEach(word_form => {
                    $(`#wordform option[value='${word_form}']`).prop('disabled', false);
                });
            }
            else {
                disabled_wordforms.forEach(word_form => {
                    $(`#wordform option[value='${word_form}']`).prop('disabled', true);
                });
                // If one of the wordforms that will be disabled has been selected, reset to "sing" aka "To Singular"
                var wordform_selector = $('#wordform')[0];
                if (disabled_wordforms.includes(wordform_selector.value)) {
                    wordform_selector.value = "sing";
                }
            }
        });

        // sending a connect request to the server.
        var socket = io.connect('http://localhost:5000');

        socket.on('after connect', function (msg) {
            console.log('After connect', msg);
        });

        socket.on('output', function (json) {
            console.log("Received output: ");
            console.log(json);
            var output_word = json["output"];
            $('#inflexion_output').text = output_word;
        });

        $('#inflexion_form').submit(function (e) {
            e.preventDefault();

            // Set form validation
            var form = $('#inflexion_form')[0];
            form.classList.add('was-validated');
            if (!form.checkValidity()) {
                return;
            }

            socket.emit("input", {
                pos: $("#pos").val(),
                wordform: $("#wordform").val(),
                word: $("#word").val(),
            });

            // TODO: Have waiting symbol
        });
    });

</script>

</html>